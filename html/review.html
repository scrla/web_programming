<!DOCTYPE html> 
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë™ì•„ë¦¬ ìœ„í‚¤ - CAPS</title>
    <link rel="stylesheet" href="review_style.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function() {
            // ë¦¬ë·° ì“°ê¸° ë²„íŠ¼ í´ë¦­ ì‹œ ì´ë²¤íŠ¸ (review_write í˜ì´ì§€ì—ì„œ ë³„ì  ë°ì´í„°ë¥¼ ë°›ëŠ”ë‹¤ê³  ê°€ì •)
            $('#write-review').on('click', function() {
                // ì˜ˆì‹œ ë°ì´í„°: review_write í˜ì´ì§€ì—ì„œ ë°›ì•„ì˜¨ ë³„ì  íŒŒë¼ë¯¸í„°
                const categoryRatings = {
                    ë¶„ìœ„ê¸°: 4,
                    ìš´ì˜: 4,
                    í™œë™: 4
                };
                
                // í•­ëª©ë³„ í‰ì  ì—…ë°ì´íŠ¸
                $('.category-ratings').html(`
                    <p>${categoryRatings.ë¶„ìœ„ê¸°}â˜… ë¶„ìœ„ê¸°</p>
                    <p>${categoryRatings.ìš´ì˜}â˜… ìš´ì˜</p>
                    <p>${categoryRatings.í™œë™}â˜… í™œë™</p>
                `);
                
                // ì´ í‰ì  ê³„ì‚°
                const totalRating = (categoryRatings.ë¶„ìœ„ê¸° + categoryRatings.ìš´ì˜ + categoryRatings.í™œë™) / 3;
                $('.rating-summary h3').text(totalRating.toFixed(1));
                
                // ì´ í‰ì  ë³„ì  ì•„ì´ì½˜ ê°±ì‹ 
                const fullStars = 'â˜…'.repeat(Math.floor(totalRating));
                const halfStar = (totalRating % 1 >= 0.5) ? 'â˜†' : '';
                const emptyStars = 'â˜†'.repeat(4 - Math.floor(totalRating));
                $('.rating-summary .stars').html(`${fullStars}${halfStar}${emptyStars}`);
            });
        });

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ëª¨ë“  ë¦¬ë·°ì˜ ì¢‹ì•„ìš”/ì‹«ì–´ìš” ìˆ˜ë¥¼ í‘œì‹œ
        window.onload = function() {
            updateAllReviewCounts();
        };
    
        // ì‚¬ìš©ì IDì™€ ë¦¬ë·° IDë¥¼ ì¡°í•©í•œ í‚¤ë¥¼ ìƒì„±í•˜ëŠ” í•¨ìˆ˜
        function createUserReviewKey(userId, reviewId) {
            return `user_${userId}_review_${reviewId}`;
        }
    
        // íŠ¹ì • ë¦¬ë·°ì˜ ì¢‹ì•„ìš”/ì‹«ì–´ìš” ìˆ˜ë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
        function getReviewCounts(reviewId) {
            const counts = JSON.parse(localStorage.getItem(`review_counts_${reviewId}`)) || {
                likes: 0,
                dislikes: 0
            };
            return counts;
        }
    
        // ëª¨ë“  ë¦¬ë·°ì˜ ì¹´ìš´íŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•˜ëŠ” í•¨ìˆ˜
        function updateAllReviewCounts() {
            const reviewElements = document.querySelectorAll('[data-review-id]');
            reviewElements.forEach(element => {
                const reviewId = element.dataset.reviewId;
                const counts = getReviewCounts(reviewId);
                
                const likeCount = element.querySelector(`#likeCount${reviewId}`);
                const dislikeCount = element.querySelector(`#dislikeCount${reviewId}`);
                
                if (likeCount) likeCount.innerText = counts.likes;
                if (dislikeCount) dislikeCount.innerText = counts.dislikes;
    
                // ì‚¬ìš©ìì˜ ì´ì „ ì„ íƒì„ í‘œì‹œ
                const userId = getCurrentUserId(); // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ IDë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ (êµ¬í˜„ í•„ìš”)
                const userSelection = getUserSelection(userId, reviewId);
                
                const likeButton = element.querySelector('.like-button');
                const dislikeButton = element.querySelector('.dislike-button');
                
                if (userSelection.liked) {
                    likeButton?.classList.add('selected');
                }
                if (userSelection.disliked) {
                    dislikeButton?.classList.add('selected');
                }
            });
        }
    
        // ì‚¬ìš©ìì˜ ì„ íƒ ìƒíƒœë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
        function getUserSelection(userId, reviewId) {
            const key = createUserReviewKey(userId, reviewId);
            return JSON.parse(localStorage.getItem(key)) || {
                liked: false,
                disliked: false
            };
        }
    
        // ì‚¬ìš©ìì˜ ì„ íƒì„ ì €ì¥í•˜ëŠ” í•¨ìˆ˜
        function saveUserSelection(userId, reviewId, selection) {
            const key = createUserReviewKey(userId, reviewId);
            localStorage.setItem(key, JSON.stringify(selection));
        }
    
        // ì¢‹ì•„ìš”/ì‹«ì–´ìš” í† ê¸€ í•¨ìˆ˜
        function toggleLikeDislike(type, reviewId) {
            const userId = getCurrentUserId(); // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ IDë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ (êµ¬í˜„ í•„ìš”)
            if (!userId) {
                alert('ë¡œê·¸ì¸ì´ í•„ìš”í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤.');
                return;
            }
    
            const userSelection = getUserSelection(userId, reviewId);
            const counts = getReviewCounts(reviewId);
            let updated = false;
    
            if (type === 'like') {
                if (!userSelection.liked) {
                    if (userSelection.disliked) {
                        counts.dislikes--;
                        userSelection.disliked = false;
                    }
                    counts.likes++;
                    userSelection.liked = true;
                    updated = true;
                } else {
                    counts.likes--;
                    userSelection.liked = false;
                    updated = true;
                }
            } else if (type === 'dislike') {
                if (!userSelection.disliked) {
                    if (userSelection.liked) {
                        counts.likes--;
                        userSelection.liked = false;
                    }
                    counts.dislikes++;
                    userSelection.disliked = true;
                    updated = true;
                } else {
                    counts.dislikes--;
                    userSelection.disliked = false;
                    updated = true;
                }
            }
    
            if (updated) {
                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì—…ë°ì´íŠ¸
                localStorage.setItem(`review_counts_${reviewId}`, JSON.stringify(counts));
                saveUserSelection(userId, reviewId, userSelection);
    
                // UI ì—…ë°ì´íŠ¸
                const likeCount = document.getElementById(`likeCount${reviewId}`);
                const dislikeCount = document.getElementById(`dislikeCount${reviewId}`);
                if (likeCount) likeCount.innerText = counts.likes;
                if (dislikeCount) dislikeCount.innerText = counts.dislikes;
    
                // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ì—…ë°ì´íŠ¸
                const likeButton = document.querySelector(`[data-review-id="${reviewId}"] .like-button`);
                const dislikeButton = document.querySelector(`[data-review-id="${reviewId}"] .dislike-button`);
                
                if (likeButton) {
                    likeButton.classList.toggle('selected', userSelection.liked);
                }
                if (dislikeButton) {
                    dislikeButton.classList.toggle('selected', userSelection.disliked);
                }
            }
        }
    
        // ë¶ë§ˆí¬ í† ê¸€ í•¨ìˆ˜
        function toggleBookmark() {
            const star = document.getElementById("scrap");
            star.classList.toggle("bookmarked");
        }
    
        // í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ IDë¥¼ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜ (ì˜ˆì‹œ)
        function getCurrentUserId() {
            // ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ì„¸ì…˜ì´ë‚˜ ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ í˜„ì¬ ë¡œê·¸ì¸í•œ ì‚¬ìš©ìì˜ IDë¥¼ ë°˜í™˜
            return sessionStorage.getItem('currentUserId');
        }
    </script>
</head>
<body>
    <header>
        <div class="header-content">
            <div class="logo-container">
                <img src="logo.png" alt="ë™êµ­ëŒ€í•™êµ ë¡œê³ ">
                <div class="site-name">
                    <div class="small-text">ë™êµ­ëŒ€í•™êµ ë™ì•„ë¦¬ ìœ„í‚¤</div>
                    <div class="large-text">ë™ë™</div>
                </div>
            </div>
            <nav>
                <a href="main.html">í™ˆ</a>
                <a href="#" class="active">ë™ì•„ë¦¬</a>
            </nav>
            <div class="header-right"> <!-- Wrapper to control alignment -->
                <div class="search-bar">
                    <input type="search" class="keyword" placeholder="ì°¾ìœ¼ì‹œëŠ” ë™ì•„ë¦¬ê°€ ìˆë‚˜ìš”?">
                    <button class="submit">
                        <img src="search.png" alt="Search">
                    </button>
                </div>
                <div class="user-menu">
                    <a href="mypage.html">ë§ˆì´í˜ì´ì§€</a>
                </div>
            </div>
        </div>
    </header>

    <main>
        <section class="club-info">
            <div class =  "logo-container">
                <img src="caps_logo.png" alt="CAPS Logo">
                <div class="site-name">
                    <div class="large-text">CAPS</div> 
                    <div class="small-text">100ëª… ì´ìƒ</div><!--ë¶€ì›ìˆ˜-->
                </div>
                <div id="scrap" class="scrap" onclick="toggleBookmark()">â˜…</div>
            </div><br>
            <h3>ì¸ê¸° ë¦¬ë·°</h3>
            <div class="review"><!--ë¦¬ë·°-->
                <p>ëŒ€ì™¸ í™œë™ì´ ë§ì•„ì„œ ì¢‹ì•˜ì–´ìš”! ì—¬ëŸ¬ ì•¼ì™¸ í™œë™ì„ í•˜ë©´ì„œ ë‹¤ì–‘í•œ ê²½í—˜ì„ í•  ìˆ˜ ìˆì—ˆì–´ìš”.</p>
            </div>
            <div class="review">
                <p>ì¹œëª© ìœ„ì£¼ì˜ ë¶„ìœ„ê¸°ë¼ ì—¬ëŸ¬ ì‚¬ëŒì„ ë§Œë‚˜ê³  ì‹¶ì„ ë•Œ ì¶”ì²œë“œë ¤ìš”!</p>
            </div>
            <div class="write">
                <button class="write-button"><a href="#">ë¦¬ë·°ì“°ê¸°</a></button>
            </div>
        </section>

        <section class="reviews">
            <div class="ratings">
                <div class="rating-summary">
                    <h3>4.0</h3>
                    <div class="stars">â˜…â˜…â˜…â˜…â˜†</div><!--ì´í‰ì -->
                </div>
                <div class="divider"></div>
                <div class="category-ratings">
                    <h4>í‰ì ë³„ í•­ëª©</h4>
                    <p><b>4.0â˜…</b>&nbsp;&nbsp;&nbsp;ë¶„ìœ„ê¸°</p>
                    <p><b>4.0â˜…</b>&nbsp;&nbsp;&nbsp;ìš´ì˜</p>
                    <p><b>4.0â˜…</b>&nbsp;&nbsp;&nbsp;í™œë™</p>
                </div>
            </div>
            
            <ul class="review-list">
                <li class="review-item">
                    <div class="review-header">
                        <span class="review-rating">4.5<br>â˜…â˜…â˜…â˜…â˜†</span>
                    </div>
                    <div class ="review-body">
                        <strong class="review-title">"ëŒ€ì™¸ í™œë™í•˜ê¸° ì¢‹ì•„ìš”"</strong>
                        <p class="review-author">ë™êµ­ëŒ€ 23í•™ë²ˆ</p>
                        <p class="review-content">ëŒ€ì™¸í™œë™í•˜ê¸° ë§‰ë§‰í–ˆëŠ”ë° ë•ë¶„ì— ë§ì´ ë°°ì› ìŠµë‹ˆë‹¤!
                            ì—¬ëŸ¬ í™œë™ì´ ìˆì–´ì„œ ì¬ë°Œì—ˆì–´ìš”.
                            ë‹¤ë§Œ ì•„ì‰¬ì› ë˜ ì ì´ ëª‡ê°€ì§€ ìˆì–´ì„œ ì ì–´ë³´ê³ ì í•©ë‹ˆë‹¤.</p>
                        <div class="review-controls">
                            <span class="like" onclick="toggleLikeDislike('like', 0)">ğŸ‘</span> <span id="likeCount0">0</span>
                            <span class="dislike" onclick="toggleLikeDislike('dislike', 0)">ğŸ‘</span> <span id="dislikeCount0">0</span>
                        </div>
                    </div>
                </li>
                <li class="review-item">
                    <div class="review-header">
                        <span class="review-rating">5.0<br>â˜…â˜…â˜…â˜…â˜…</span>
                    </div>
                    <div class ="review-body">
                        <strong class="review-title">"ìŠ¤í„°ë””ê°€ ê°€ì¥ ì˜ ìš´ì˜ë˜ê³  ìˆëŠ” ë™ì•„ë¦¬"</strong>
                        <p class="review-author">ë™êµ­ëŒ€ 23í•™ë²ˆ</p>
                        <p class="review-content">í•™ìˆ  ë™ì•„ë¦¬ë¥¼ í•˜ë©´ì„œ ì ì ˆí•œ ì¹œëª©ë„ ìŒ“ê³ , ë‹¤ì–‘í•œ ìŠ¤í„°ë””ë¥¼ ê²½í—˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. í”„ë¡œê·¸ë˜ë°ì„ ë°°ìš°ëŠ” ë° ê´€ì‹¬ìˆë‹¤ë©´ ì´ ë™ì•„ë¦¬ë¥¼ ê°€ì¥ ì¶”ì²œë“œë¦½ë‹ˆë‹¤!</p>
                        <div class="review-controls">
                            <span class="like" onclick="toggleLikeDislike('like', 1)">ğŸ‘</span> <span id="likeCount1">0</span>
                            <span class="dislike" onclick="toggleLikeDislike('dislike', 1)">ğŸ‘</span> <span id="dislikeCount1">0</span>
                        </div>
                    </div>
                </li>
                <!-- ì¶”ê°€ ë¦¬ë·° í•­ëª©ì€ ë™ì¼í•œ êµ¬ì¡°ë¡œ ì¶”ê°€ -->
            </ul>

        </section>

        <aside class="sidebars">
            <h3>ë¹„ìŠ·í•œ ë™ì•„ë¦¬</h3>
            <div class="sidebar">
                <li class="club-item">
                    <div class="text-container">
                        <a href="#">ë©‹ìŸì´ì‚¬ìì²˜ëŸ¼</a>
                    </div>
                </li>
                <li class="club-item">
                    <div class="text-container">
                        <a href="#">DNA</a>
                    </div>
                </li>
            </div>
            
            
            <div class="apply">
                <p>ë™ì•„ë¦¬ ì§€ì› ê¸°ê°„</p>
                <!--ì •ë³´ ë°›ì•„ì˜´-->
                <p>9.1 ~ 9.10</p><br>
                <button>ì§€ì›í•˜ê¸°</button> 
            </div>
        </aside>
    </main>
</body>
</html>
